# Block Editor Build Process

This document explains the build process for the XV Random Quotes Block Editor sidebar panel.

## Prerequisites

- Node.js 18.x or higher
- npm 8.x or higher

## Setup

Install dependencies:

```bash
npm install
```

## Development

### Build for Production

Compile and minify the JavaScript for production:

```bash
npm run build
```

This creates optimized files in the `src/generated/` directory:
- `src/generated/quote-details.js` - Minified JavaScript bundle
- `src/generated/quote-details.asset.php` - WordPress asset dependency file

### Development Mode

Run the development server with hot reloading:

```bash
npm start
```

This watches for changes and automatically rebuilds. The development build includes source maps for debugging.

### Code Quality

Format code according to WordPress standards:

```bash
npm run format
```

Lint JavaScript files:

```bash
npm run lint:js
```

Lint package.json:

```bash
npm run lint:pkg-json
```

## File Structure

```
src/blocks/quote-details/
  └── index.js           # Entry point for Block Editor sidebar panel

src/generated/           # Generated by build process (NOT gitignored)
  ├── quote-details.js
  └── quote-details.asset.php

webpack.config.js        # Custom webpack configuration
package.json             # Node dependencies and build scripts
```

## Webpack Configuration

The project uses `@wordpress/scripts` which provides:
- JSX/React transformation
- ES6+ compilation via Babel
- Code splitting and optimization
- Hot module replacement (HMR)
- Source maps

The custom `webpack.config.js` extends the default configuration to specify the entry point for the sidebar panel.

## WordPress Integration

The built JavaScript is enqueued in WordPress via:
- PHP class: `src/Admin/BlockEditorAssets.php` (to be created in Task 22)
- Enqueued on Block Editor screens for `xv_quote` post type
- Dependencies automatically loaded via `quote-details.asset.php`

## Distribution and Deployment

### Important: Build Artifacts Must Be Committed

Unlike typical JavaScript projects, **the `src/generated/` directory MUST be committed to Git** for WordPress plugin distribution. Here's why:

1. **WordPress.org doesn't run build processes** - The plugin repository expects ready-to-use files
2. **Users download compiled code** - End users don't have Node.js or npm installed
3. **The `build/` directory is NOT in `.gitignore`** - This is intentional for WordPress plugins

### Deployment Workflow

Before releasing a new version:

1. **Build for production:**
   ```bash
   npm run build
   ```

2. **Commit the build artifacts:**
   ```bash
   git add src/generated/
   git commit -m "Build assets for version X.Y.Z"
   ```

3. **Run deployment script:**
   ```bash
   ./bin/git-to-svn.sh
   ```

The deployment script automatically:
- Excludes `node_modules/`, `src/blocks/`, `package.json`, etc. from WordPress.org
- Includes the compiled `src/generated/` directory (part of `src/`)
- Moves `assets/` directory to SVN root (for WordPress.org screenshots/banners)

### What Gets Deployed to WordPress.org

**Included:**
- `src/generated/` - Compiled JavaScript and asset files ✅
- `src/` (all files) - PHP source files and compiled JavaScript
- `inc/`, `lib/`, `admin/` - Legacy PHP code
- `lang/` - Translation files
- Plugin root files (`.php`, `readme.txt`, etc.)

**Excluded (automatically removed by deployment script):**
- `src/blocks/` - Source JavaScript (only compiled kept) ❌
- `node_modules/` - npm dependencies ❌
- `package.json`, `package-lock.json` - npm config ❌
- `webpack.config.js` - Build configuration ❌
- `tests/`, `bin/` - Test files and scripts ❌
- Docker files, Makefile, development docs ❌
- `composer.json`, `composer.lock` - Composer config ❌

**Result:** Users only get production-ready files in a single `src/` directory tree.

## Troubleshooting

### Build fails with module errors

Run `npm install` to ensure all dependencies are installed.

### Changes not reflected

1. Stop `npm start` if running
2. Delete `src/generated/` directory
3. Run `npm run build` again

### Hot reload not working

Check that you're running `npm start` (not `npm run build`) during development.
